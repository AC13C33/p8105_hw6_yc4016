p8105_hw6_yc4016
================
Yishan Chen
2022-12-01

# Problem 2

``` r
homicide_df = 
  read_csv("./data/homicide-data.csv") %>% 
  mutate(city_state = str_c(city, state, sep = ", ", collapse = NULL),
         homicide_situation = as.numeric(disposition == "Closed by arrest")) %>% 
  filter(!(city_state %in% c("Dallas, TX", "Phoenix, AZ", "Kansas City, MO", "Tulsa, AL")),
         victim_race %in% c("White", "Black")) %>% 
  mutate (victim_age = as.numeric(victim_age),
          homicide_situation = as.numeric(homicide_situation))
```

    ## Rows: 52179 Columns: 12
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (9): uid, victim_last, victim_first, victim_race, victim_age, victim_sex...
    ## dbl (3): reported_date, lat, lon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

    ## Warning in mask$eval_all_mutate(quo): NAs introduced by coercion

``` r
homicide_df
```

    ## # A tibble: 39,693 × 14
    ##    uid   repor…¹ victi…² victi…³ victi…⁴ victi…⁵ victi…⁶ city  state   lat   lon
    ##    <chr>   <dbl> <chr>   <chr>   <chr>     <dbl> <chr>   <chr> <chr> <dbl> <dbl>
    ##  1 Alb-…  2.01e7 SATTER… VIVIANA White        15 Female  Albu… NM     35.1 -107.
    ##  2 Alb-…  2.01e7 MULA    VIVIAN  White        72 Female  Albu… NM     35.1 -107.
    ##  3 Alb-…  2.01e7 BOOK    GERALD… White        91 Female  Albu… NM     35.2 -107.
    ##  4 Alb-…  2.01e7 MARTIN… GUSTAVO White        56 Male    Albu… NM     35.1 -107.
    ##  5 Alb-…  2.01e7 LUJAN   KEVIN   White        NA Male    Albu… NM     35.1 -107.
    ##  6 Alb-…  2.01e7 GRAY    STEFAN… White        43 Female  Albu… NM     35.1 -107.
    ##  7 Alb-…  2.01e7 DAVID   LARRY   White        52 Male    Albu… NM     NA     NA 
    ##  8 Alb-…  2.01e7 BRITO   ELIZAB… White        22 Female  Albu… NM     35.1 -107.
    ##  9 Alb-…  2.01e7 KING    TEVION  Black        15 Male    Albu… NM     35.1 -107.
    ## 10 Alb-…  2.01e7 BOYKIN  CEDRIC  Black        25 Male    Albu… NM     35.1 -107.
    ## # … with 39,683 more rows, 3 more variables: disposition <chr>,
    ## #   city_state <chr>, homicide_situation <dbl>, and abbreviated variable names
    ## #   ¹​reported_date, ²​victim_last, ³​victim_first, ⁴​victim_race, ⁵​victim_age,
    ## #   ⁶​victim_sex

``` r
fit_logistic_baltimore = 
  homicide_df %>% 
  filter(city_state == "Baltimore, MD") %>%
  glm(homicide_situation ~ victim_age + victim_sex + victim_age, data = ., family = binomial()) 

fit_logistic_baltimore
```

    ## 
    ## Call:  glm(formula = homicide_situation ~ victim_age + victim_sex + 
    ##     victim_age, family = binomial(), data = .)
    ## 
    ## Coefficients:
    ##    (Intercept)      victim_age  victim_sexMale  
    ##       0.384309       -0.004192       -0.966250  
    ## 
    ## Degrees of Freedom: 2752 Total (i.e. Null);  2750 Residual
    ## Null Deviance:       3568 
    ## Residual Deviance: 3516  AIC: 3522

``` r
fit_logistic_baltimore %>% 
  broom::tidy() %>% 
  mutate(OR = exp(estimate),
         lower_bound = exp(estimate - 1.96 * std.error),
         upper_bound = exp(estimate + 1.96 * std.error)) %>%
  select(term, estimate, OR, lower_bound, upper_bound) %>%
  filter(term == "victim_sexMale") %>% 
  knitr::kable(digits = 3)
```

| term           | estimate |    OR | lower_bound | upper_bound |
|:---------------|---------:|------:|------------:|------------:|
| victim_sexMale |   -0.966 | 0.381 |       0.292 |       0.496 |

``` r
fit_logistic_all =
  homicide_df %>% 
  nest(data = -city_state) %>% 
  mutate(models = map(data, ~glm(homicide_situation ~ victim_age + victim_sex + victim_age, data = .x, family = binomial())),
         results = map(models, broom::tidy)) %>% 
  select(-data, -models) %>% 
  unnest(results)

fit_logistic_all
```

    ## # A tibble: 146 × 6
    ##    city_state      term               estimate std.error statistic  p.value
    ##    <chr>           <chr>                 <dbl>     <dbl>     <dbl>    <dbl>
    ##  1 Albuquerque, NM (Intercept)         1.00      0.493      2.04   4.17e- 2
    ##  2 Albuquerque, NM victim_age         -0.0197    0.00906   -2.17   2.97e- 2
    ##  3 Albuquerque, NM victim_sexMale      0.486     0.374      1.30   1.94e- 1
    ##  4 Albuquerque, NM victim_sexUnknown -15.0     883.        -0.0169 9.86e- 1
    ##  5 Atlanta, GA     (Intercept)         0.882     0.241      3.66   2.57e- 4
    ##  6 Atlanta, GA     victim_age         -0.0110    0.00460   -2.39   1.70e- 2
    ##  7 Atlanta, GA     victim_sexMale     -0.0209    0.193     -0.108  9.14e- 1
    ##  8 Baltimore, MD   (Intercept)         0.384     0.169      2.27   2.33e- 2
    ##  9 Baltimore, MD   victim_age         -0.00419   0.00326   -1.29   1.99e- 1
    ## 10 Baltimore, MD   victim_sexMale     -0.966     0.135     -7.15   8.57e-13
    ## # … with 136 more rows

``` r
fit_logistic_all %>% 
  mutate(OR = exp(estimate),
         lower_bound = exp(estimate - 1.96 * std.error),
         upper_bound = exp(estimate + 1.96 * std.error)) %>%
  filter(term == "victim_sexMale") %>% 
  select(city_state, OR, lower_bound, upper_bound) %>%
  knitr::kable(digits = 3)
```

| city_state         |    OR | lower_bound | upper_bound |
|:-------------------|------:|------------:|------------:|
| Albuquerque, NM    | 1.626 |       0.781 |       3.387 |
| Atlanta, GA        | 0.979 |       0.671 |       1.429 |
| Baltimore, MD      | 0.381 |       0.292 |       0.496 |
| Baton Rouge, LA    | 0.363 |       0.200 |       0.657 |
| Birmingham, AL     | 0.873 |       0.577 |       1.322 |
| Boston, MA         | 0.446 |       0.250 |       0.797 |
| Buffalo, NY        | 0.484 |       0.272 |       0.861 |
| Charlotte, NC      | 0.846 |       0.535 |       1.337 |
| Chicago, IL        | 0.397 |       0.325 |       0.484 |
| Cincinnati, OH     | 0.345 |       0.206 |       0.578 |
| Columbus, OH       | 0.515 |       0.368 |       0.720 |
| Denver, CO         | 0.426 |       0.213 |       0.851 |
| Detroit, MI        | 0.567 |       0.451 |       0.714 |
| Durham, NC         | 0.817 |       0.406 |       1.644 |
| Fort Worth, TX     | 0.663 |       0.395 |       1.113 |
| Fresno, CA         | 1.140 |       0.508 |       2.557 |
| Houston, TX        | 0.706 |       0.555 |       0.899 |
| Indianapolis, IN   | 0.780 |       0.583 |       1.043 |
| Jacksonville, FL   | 0.656 |       0.492 |       0.874 |
| Las Vegas, NV      | 0.799 |       0.583 |       1.095 |
| Long Beach, CA     | 0.414 |       0.159 |       1.077 |
| Los Angeles, CA    | 0.582 |       0.407 |       0.831 |
| Louisville, KY     | 0.403 |       0.254 |       0.640 |
| Memphis, TN        | 0.714 |       0.523 |       0.975 |
| Miami, FL          | 0.503 |       0.299 |       0.848 |
| Milwaukee, wI      | 0.696 |       0.478 |       1.012 |
| Minneapolis, MN    | 0.860 |       0.441 |       1.677 |
| Nashville, TN      | 1.018 |       0.675 |       1.535 |
| New Orleans, LA    | 0.566 |       0.409 |       0.783 |
| New York, NY       | 0.246 |       0.130 |       0.466 |
| Oakland, CA        | 0.499 |       0.328 |       0.760 |
| Oklahoma City, OK  | 0.869 |       0.567 |       1.331 |
| Omaha, NE          | 0.297 |       0.164 |       0.535 |
| Philadelphia, PA   | 0.472 |       0.360 |       0.619 |
| Pittsburgh, PA     | 0.388 |       0.241 |       0.624 |
| Richmond, VA       | 1.009 |       0.501 |       2.033 |
| San Antonio, TX    | 0.687 |       0.389 |       1.214 |
| Sacramento, CA     | 0.664 |       0.333 |       1.326 |
| Savannah, GA       | 0.759 |       0.380 |       1.514 |
| San Bernardino, CA | 0.500 |       0.172 |       1.453 |
| San Diego, CA      | 0.380 |       0.185 |       0.778 |
| San Francisco, CA  | 0.513 |       0.273 |       0.966 |
| St. Louis, MO      | 0.687 |       0.519 |       0.909 |
| Stockton, CA       | 1.156 |       0.546 |       2.449 |
| Tampa, FL          | 0.836 |       0.363 |       1.924 |
| Tulsa, OK          | 0.850 |       0.542 |       1.331 |
| Washington, DC     | 0.674 |       0.458 |       0.993 |
